<div class="checkout-container">
  <div class="checkout-background">
    <div class="floating-shapes">
      <div class="shape shape-1"></div>
      <div class="shape shape-2"></div>
      <div class="shape shape-3"></div>
    </div>
  </div>

  <!-- Success Page -->
  <div *ngIf="orderSuccess" class="success-container">
    <div class="success-card">
      <div class="success-celebration">
        <div class="celebration-emojis">üéâ üõí üçé üéä</div>
      </div>
      
      <div class="success-icon">
        <i class="fas fa-check-circle"></i>
      </div>
      
      <h1 class="success-title">Order Placed Successfully!</h1>
      <p class="success-subtitle">üéâ Congratulations! Your order has been confirmed</p>
      
      <div class="success-badges">
        <div class="badge badge-success">
          <i class="fas fa-check me-1"></i>
          Payment Confirmed
        </div>
        <div class="badge badge-info">
          <i class="fas fa-truck me-1"></i>
          Processing Started
        </div>
      </div>
      
      <div class="order-details">
        <div class="order-id">
          <i class="fas fa-receipt me-2"></i>
          <strong>Order ID: {{ orderId }}</strong>
        </div>
        <div class="order-summary">
          <div class="summary-row">
            <span>Total Items:</span>
            <strong>{{ cart.totalItems }} items</strong>
          </div>
          <div class="summary-row">
            <span>Total Amount:</span>
            <strong>‚Çπ{{ getTotalWithDelivery() }}</strong>
          </div>
          <div class="summary-row highlight">
            <span>Expected Delivery:</span>
            <strong>{{ getEstimatedDelivery() }}</strong>
          </div>
        </div>
        
        <div class="delivery-tracking">
          <h4><i class="fas fa-map-marked-alt me-2"></i>Order Tracking</h4>
          <div class="tracking-steps">
            <div class="tracking-step completed">
              <div class="step-icon">‚úì</div>
              <div class="step-text">Order Confirmed</div>
            </div>
            <div class="tracking-step">
              <div class="step-icon">üì¶</div>
              <div class="step-text">Preparing</div>
            </div>
            <div class="tracking-step">
              <div class="step-icon">üöö</div>
              <div class="step-text">Out for Delivery</div>
            </div>
            <div class="tracking-step">
              <div class="step-icon">üè†</div>
              <div class="step-text">Delivered</div>
            </div>
          </div>
        </div>
      </div>
      
      <div class="success-message-box">
        <h3>üôè Thank You for Your Order!</h3>
        <p>We're excited to deliver fresh, delicious fruits to your doorstep. You'll receive SMS and email updates about your order status.</p>
      </div>
      
      <div class="success-actions">
        <button class="btn btn-primary-gradient" (click)="goToHome()">
          <i class="fas fa-home me-2"></i>
          Go to Home
        </button>
        <button class="btn btn-success-gradient" (click)="continueShopping()">
          <i class="fas fa-shopping-cart me-2"></i>
          Continue Shopping
        </button>
      </div>
      
      <div class="contact-support">
        <p><i class="fas fa-headset me-2"></i>Need help? Contact our support team: <strong>+91 98765 43210</strong></p>
      </div>
    </div>
  </div>

  <!-- Checkout Form -->
  <div *ngIf="!orderSuccess" class="container-fluid">
    <div class="row justify-content-center">
      <div class="col-12 col-lg-10 col-xl-8">
        
        <!-- Header -->
        <div class="checkout-header">
          <h1 class="checkout-title">
            <i class="fas fa-credit-card me-3"></i>
            Secure Checkout
          </h1>
          <p class="checkout-subtitle">Complete your purchase in 3 simple steps</p>
        </div>

        <!-- Progress Steps -->
        <div class="progress-container">
          <div class="progress-steps">
            <div class="step" [class.active]="currentStep >= 1" [class.completed]="currentStep > 1">
              <div class="step-number">1</div>
              <div class="step-label">Personal Info</div>
            </div>
            <div class="step-line" [class.completed]="currentStep > 1"></div>
            <div class="step" [class.active]="currentStep >= 2" [class.completed]="currentStep > 2">
              <div class="step-number">2</div>
              <div class="step-label">Delivery</div>
            </div>
            <div class="step-line" [class.completed]="currentStep > 2"></div>
            <div class="step" [class.active]="currentStep >= 3" [class.completed]="currentStep > 3">
              <div class="step-number">3</div>
              <div class="step-label">Payment</div>
            </div>
          </div>
        </div>

        <div class="row g-4">
          <!-- Form Section -->
          <div class="col-lg-8">
            <div class="checkout-form-card">
              
              <!-- Step 1: Personal Information -->
              <div *ngIf="currentStep === 1" class="form-step">
                <h3 class="step-title">
                  <i class="fas fa-user me-2"></i>
                  Personal Information
                </h3>
                
                <div class="row g-3">
                  <div class="col-md-6">
                    <label class="form-label">First Name *</label>
                    <input type="text" class="form-control form-control-modern" 
                           [(ngModel)]="userInfo.firstName" placeholder="Enter first name" required>
                  </div>
                  <div class="col-md-6">
                    <label class="form-label">Last Name *</label>
                    <input type="text" class="form-control form-control-modern" 
                           [(ngModel)]="userInfo.lastName" placeholder="Enter last name" required>
                  </div>
                  <div class="col-md-6">
                    <label class="form-label">Email Address *</label>
                    <input type="email" class="form-control form-control-modern" 
                           [(ngModel)]="userInfo.email" placeholder="Enter email address" required>
                  </div>
                  <div class="col-md-6">
                    <label class="form-label">Phone Number *</label>
                    <input type="tel" class="form-control form-control-modern" 
                           [(ngModel)]="userInfo.phone" placeholder="Enter phone number" required>
                  </div>
                </div>
              </div>

              <!-- Step 2: Delivery Information -->
              <div *ngIf="currentStep === 2" class="form-step">
                <h3 class="step-title">
                  <i class="fas fa-truck me-2"></i>
                  Delivery Information
                </h3>
                
                <div class="row g-3">
                  <div class="col-12">
                    <label class="form-label">Delivery Address *</label>
                    <textarea class="form-control form-control-modern" rows="3"
                              [(ngModel)]="deliveryInfo.address" 
                              placeholder="Enter complete delivery address" required></textarea>
                  </div>
                  <div class="col-md-6">
                    <label class="form-label">City *</label>
                    <input type="text" class="form-control form-control-modern" 
                           [(ngModel)]="deliveryInfo.city" placeholder="Enter city" required>
                  </div>
                  <div class="col-md-6">
                    <label class="form-label">PIN Code *</label>
                    <input type="text" class="form-control form-control-modern" 
                           [(ngModel)]="deliveryInfo.pincode" placeholder="Enter PIN code" required>
                  </div>
                  <div class="col-12">
                    <label class="form-label">Landmark (Optional)</label>
                    <input type="text" class="form-control form-control-modern" 
                           [(ngModel)]="deliveryInfo.landmark" placeholder="Nearby landmark">
                  </div>
                  <div class="col-12">
                    <label class="form-label">Delivery Time</label>
                    <div class="delivery-options">
                      <div class="delivery-option">
                        <input type="radio" id="standard" name="deliveryTime" value="standard" 
                               [(ngModel)]="deliveryInfo.deliveryTime">
                        <label for="standard" class="delivery-option-label">
                          <div class="option-header">
                            <strong>Standard Delivery</strong>
                            <span class="option-price">‚Çπ{{ cart.totalAmount > 500 ? 0 : 49 }}</span>
                          </div>
                          <div class="option-description">3-5 business days</div>
                        </label>
                      </div>
                      <div class="delivery-option">
                        <input type="radio" id="express" name="deliveryTime" value="express" 
                               [(ngModel)]="deliveryInfo.deliveryTime">
                        <label for="express" class="delivery-option-label">
                          <div class="option-header">
                            <strong>Express Delivery</strong>
                            <span class="option-price">‚Çπ99</span>
                          </div>
                          <div class="option-description">Next day delivery</div>
                        </label>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Step 3: Payment Information -->
              <div *ngIf="currentStep === 3" class="form-step">
                <h3 class="step-title">
                  <i class="fas fa-credit-card me-2"></i>
                  Payment Information
                </h3>
                
                <div class="payment-methods">
                  <div class="payment-method">
                    <input type="radio" id="card" name="paymentMethod" value="card" 
                           [(ngModel)]="paymentInfo.method">
                    <label for="card" class="payment-method-label">
                      <i class="fas fa-credit-card me-2"></i>
                      Credit/Debit Card
                    </label>
                  </div>
                  <div class="payment-method">
                    <input type="radio" id="upi" name="paymentMethod" value="upi" 
                           [(ngModel)]="paymentInfo.method">
                    <label for="upi" class="payment-method-label">
                      <i class="fas fa-mobile-alt me-2"></i>
                      UPI Payment
                    </label>
                  </div>
                  <div class="payment-method">
                    <input type="radio" id="cod" name="paymentMethod" value="cod" 
                           [(ngModel)]="paymentInfo.method">
                    <label for="cod" class="payment-method-label">
                      <i class="fas fa-money-bill-wave me-2"></i>
                      Cash on Delivery
                    </label>
                  </div>
                </div>

                <div *ngIf="paymentInfo.method === 'card'" class="card-details">
                  <div class="row g-3">
                    <div class="col-12">
                      <label class="form-label">Card Number *</label>
                      <input type="text" class="form-control form-control-modern" 
                             [(ngModel)]="paymentInfo.cardNumber" 
                             placeholder="1234 5678 9012 3456" maxlength="19" required>
                    </div>
                    <div class="col-md-6">
                      <label class="form-label">Expiry Date *</label>
                      <input type="text" class="form-control form-control-modern" 
                             [(ngModel)]="paymentInfo.expiryDate" 
                             placeholder="MM/YY" maxlength="5" required>
                    </div>
                    <div class="col-md-6">
                      <label class="form-label">CVV *</label>
                      <input type="text" class="form-control form-control-modern" 
                             [(ngModel)]="paymentInfo.cvv" 
                             placeholder="123" maxlength="3" required>
                    </div>
                    <div class="col-12">
                      <label class="form-label">Cardholder Name *</label>
                      <input type="text" class="form-control form-control-modern" 
                             [(ngModel)]="paymentInfo.cardName" 
                             placeholder="Name on card" required>
                    </div>
                  </div>
                </div>

                <div *ngIf="paymentInfo.method === 'upi'" class="upi-details">
                  <p class="text-center">
                    <i class="fas fa-qrcode fa-3x mb-3"></i><br>
                    Scan QR code or use UPI ID: <strong>fruitbasket@upi</strong>
                  </p>
                </div>

                <div *ngIf="paymentInfo.method === 'cod'" class="cod-details">
                  <p class="text-center">
                    <i class="fas fa-hand-holding-usd fa-3x mb-3"></i><br>
                    Pay ‚Çπ{{ getTotalWithDelivery() }} when your order is delivered.
                  </p>
                </div>
              </div>

              <!-- Navigation Buttons -->
              <div class="form-navigation">
                <button *ngIf="currentStep > 1" class="btn btn-secondary-outline" (click)="previousStep()">
                  <i class="fas fa-arrow-left me-2"></i>
                  Previous
                </button>
                
                <button *ngIf="currentStep < totalSteps" 
                        class="btn btn-primary-gradient ms-auto" 
                        [disabled]="!isStepValid(currentStep)"
                        (click)="nextStep()">
                  Next
                  <i class="fas fa-arrow-right ms-2"></i>
                </button>
                
                <button *ngIf="currentStep === totalSteps" 
                        class="btn btn-success-gradient ms-auto" 
                        [disabled]="!isStepValid(currentStep) || isProcessing"
                        (click)="placeOrder()">
                  <i *ngIf="!isProcessing" class="fas fa-check me-2"></i>
                  <i *ngIf="isProcessing" class="fas fa-spinner fa-spin me-2"></i>
                  {{ isProcessing ? 'Processing...' : 'Place Order' }}
                </button>
              </div>
            </div>
          </div>

          <!-- Order Summary -->
          <div class="col-lg-4">
            <div class="order-summary-card">
              <h4 class="summary-title">
                <i class="fas fa-receipt me-2"></i>
                Order Summary
              </h4>
              
              <div class="summary-items">
                <div *ngFor="let item of cart.items" class="summary-item">
                  <div class="item-info">
                    <img [src]="item.fruit.image" [alt]="item.fruit.name" class="item-image">
                    <div class="item-details">
                      <div class="item-name">{{ item.fruit.name }}</div>
                      <div class="item-quantity">Qty: {{ item.quantity }}</div>
                    </div>
                  </div>
                  <div class="item-price">‚Çπ{{ (item.fruit.price * item.quantity).toFixed(2) }}</div>
                </div>
              </div>
              
              <div class="summary-calculations">
                <div class="calc-row">
                  <span>Subtotal ({{ cart.totalItems }} items)</span>
                  <span>‚Çπ{{ cart.totalAmount.toFixed(2) }}</span>
                </div>
                <div class="calc-row">
                  <span>Delivery Charges</span>
                  <span>‚Çπ{{ getDeliveryCharge() }}</span>
                </div>
                <div class="calc-row total-row">
                  <span>Total Amount</span>
                  <span>‚Çπ{{ getTotalWithDelivery().toFixed(2) }}</span>
                </div>
              </div>
              
              <div class="delivery-info" *ngIf="currentStep >= 2">
                <div class="delivery-estimate">
                  <i class="fas fa-calendar-alt me-2"></i>
                  Expected delivery: {{ getEstimatedDelivery() }}
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
